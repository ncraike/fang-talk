<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>reveal.js - The HTML Presentation Framework</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/solarized.css" id="theme">
    <link rel="stylesheet" href="custom.css">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section data-markdown>
          <script type="text/template">
# Fang
### Dependency injection for Python

Nathan Craike
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
## What is dependency injection?

Dependency injection is a pattern where code doesn't refer directly to resources it needs. Instead, the code relies on another piece of software providing these resources.

These other resources may be libraries, services, functions, or other objects.
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
## What is a dependency injection framework?

The dependency injection framework is the "other piece of software" in this pattern. It's responsible for tracking what code needs, and finding and giving resources when they're needed.

For… complicated reasons, it's sometimes called an "inversion of control container", an "IoC&nbsp;container" or just a "container".
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
## What does dependency injection usually look like?
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
## …as seen in Java:


          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
## Java

Several DI libraries:

 - Spring
 - Google Guice
 - Java EE6 CDI

…most use XML for configuration.
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
## C♯

More DI libraries:

 - Castle
 - Unity
 - Spring .NET

…more XML for configuration.
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
## Java and C# solutions make heavy use of:

 - static typing
 - interfaces
 - specialised config languages (usually XML)
 - and…
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">

- …an assumption that the smallest unit of code is a class.

          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
None of these things are very popular in Python.
          </script>
        </section>


        <section data-markdown>
          <script type="text/template">
## "Why would I even want dependency injection in Python?"

The common wisdom in Python is "we don't need dependency injection –
that's a tool for *other languages*."

Python is so flexible/powerful/dynamic/fantastic that we can do without.

If we do need to change dependencies, we can just mock and monkey-patch.
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
## The best reason to use dependency&nbsp;injection is unit testing.
## *Easy* &nbsp;unit testing.
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
## "Why not just mock?"

Python has a lot of great mocking tools now.

But mocking can still be a lot of hassle.
          </script>
        </section>

        <section>
<p>
How do you mock something like this?
</p>

<pre><code data-trim>
# mymodule.py
import os
import json
CONFIG_DIR, CONFIG_NAME = '~/.config/my_app', 'config.json'

class MyClass:
    def __init__(self, some_arg, another_arg):
        config_path = os.path.join(CONFIG_DIR, CONFIG_NAME)
        self.config = json.load(config_path)

instance = MyClass('some param', 'another')

# Code under test
import mymodule

def main():
    do_some_stuff_with(mymodule.instance)

</code></pre>
        </section>

        <section data-markdown>
          <script type="text/template">
## Python's import system

Python's import system encourages directly referencing actual implementations of modules, classes and functions, at import time.

Just importing a module can cause objects to be created, already referring
to real functions, classes and data, in scopes you can't easily access.
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
This can make mocking out dependencies extremely difficult: by the time your
test code is trying to mock things out, *it's too late*.
          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
## How can we make *usable* dependency injection in Python?

Well… Java and C# aren't the only games in town…
          </script>
        </section>


        <section>
          <h2>JavaScript</h2>

          <p>
            Modern JavaScript has a particular pattern for defining modules, which makes dependency injection very easy:
          </p>

<pre><code data-trim>
var myModule = (function (someDependency, another Dependency) {

    var module = {}

    module.myFunction = function () {
        // ...
    }

    return module;

})(dependencyImplementation, anotherDependencyImplementation);
</code></pre>

          </script>
        </section>

        <section data-markdown>
          <script type="text/template">
JavaScript's approach is much closer to something we'd use.

Dependencies aren't strict interfaces or types, just values with names.
          </script>
        </section>

        <section>
          <p>
          …we're probably never going to write Python like this:
          </p>

<pre><code data-trim>
# mymodule.py:
def make_mymodule(some_dependency, another_dependency):

    def my_function():
        pass

    return Module({
        'my_function': my_function
    })

# Your code:

# No imports, just this:
mymodule = make_mymodule(
    dependency_implementation,
    another_dependency_implementation)

</code></pre>
        </section>

      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'none', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true },
          // Remote control your reveal.js presentation using a touch device
          //{ src: 'plugin/remotes/remotes.js', async: true }
        ]
      });

    </script>

  </body>
</html>
